#! /bin/sh

PATH=..:$PATH

if test -d tmp
then
    if test -d tmp/modules
    then rm -f tmp/modules/* >/dev/null 2>&1
    else mkdir tmp/modules
    fi
else
    mkdir tmp tmp/modules
fi

{   echo alloca
    posix-modules
} | sort -u > tmp/posix-list

posix_list=`grep -v '^$' tmp/posix-list`

cat > tmp/modules/libposix <<- _EOF_
	Description:
	Wrap up all the posix modules into an installable libposix.la.

	Files:

	Depends-on:
	${posix_list}

	configure.ac:

	Makefile.am:
	lib_LTLIBRARIES = libposix.la

	Include:

	License:
	LGPL

	Maintainer:
	Bruce Korb
	Gary V. Vaughan
	_EOF_


opts='--local-dir=tmp
	--import
	--lib=libposix
	--makefile-name=gnulib.mk
	--macro-prefix=LIBPOSIX
	--libtool
	--no-changelog
	--symlink
	--with-tests
	--with-c++-tests
	--with-longrunning-tests'

# Bootstrap for autotools.
gnulib-tool ${opts} git-version-gen libposix


# No need to maintain a Makefile.am just to include gnulib.mk.
mv tests/gnulib.mk tests/Makefile.am

# Run autotools.
autoreconf --force --install --verbose --symlink
